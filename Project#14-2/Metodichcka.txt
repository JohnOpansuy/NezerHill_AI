–ö–æ–¥ –≤–∏–≥–ª—è–¥–∞—î –¥–æ–±—Ä–µ, –∞–ª–µ —î –∫—ñ–ª—å–∫–∞ –º–æ–º–µ–Ω—Ç—ñ–≤, —è–∫—ñ –≤–∞—Ä—Ç–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏:
1. **–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ `basa` –¥—ñ–π—Å–Ω–æ —î –µ–∫–∑–µ–º–ø–ª—è—Ä–æ–º `SQLAlchemy`** (`db = SQLAlchemy(app)`).
2. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ `UserMixin` –ø—Ä–∞–≤–∏–ª—å–Ω–æ —ñ–º–ø–æ—Ä—Ç—É—î—Ç—å—Å—è** (`from flask_login import UserMixin`).
3. **–£ `Chats` –∞—Ç—Ä–∏–±—É—Ç `__tablename__` –≤–∞—Ä—Ç–æ –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ –ø–µ—Ä–µ–¥ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è–º –∫–æ–ª–æ–Ω–æ–∫**, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –ø–æ–º–∏–ª–æ–∫.
4. **–£ `Messages` —É `backref="Chats"` —Å–ª—ñ–¥ –∑–º—ñ–Ω–∏—Ç–∏ –Ω–∞ `backref="chat"`,** —â–æ–± –ø—Ä–∏–≤‚Äô—è–∑–∫–∞ –∫–æ—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∞—Ü—é–≤–∞–ª–∞ (–Ω–∞–∑–≤–∞ —Ç–∞–±–ª–∏—Ü—ñ –≤ `ForeignKey` ‚Äì `"chats.id"`, –∞ –Ω–µ `"Chats.id"`).
5. **–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –±–∞–∑—É –¥–∞–Ω–∏—Ö `basa` —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ**.

---

### **–ü–æ–∫—Ä–æ–∫–æ–≤–µ –ø–æ—è—Å–Ω–µ–Ω–Ω—è —Ç–æ–≥–æ, —è–∫ —É—Å–µ –ø—Ä–∞—Ü—é—î**
#### 1Ô∏è‚É£ **`Users` ‚Äì –ö–ª–∞—Å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**
–¶—è –º–æ–¥–µ–ª—å –∑–±–µ—Ä—ñ–≥–∞—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤. –ö–ª—é—á–æ–≤—ñ –ø–æ–ª—è:
- **`id`** ‚Äì —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
- **`user_name`** ‚Äì —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–Ω–µ —É–Ω—ñ–∫–∞–ª—å–Ω–µ —á–µ—Ä–µ–∑ –º–æ–∂–ª–∏–≤—É —Å–µ—Ä–≤–µ—Ä–Ω—É –ø–æ–º–∏–ª–∫—É).
- **`user_mail`** ‚Äì —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π email.
- **`user_password`** ‚Äì –∑–±–µ—Ä—ñ–≥–∞—î –ø–∞—Ä–æ–ª—å (–∑–∞–∑–≤–∏—á–∞–π —Ç—É—Ç –ø–æ—Ç—Ä—ñ–±–Ω–æ —Ö–µ—à—É–≤–∞—Ç–∏ –ø–∞—Ä–æ–ª—å!).
- **`user_data`, `last_seen`, `user_status`** ‚Äì –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –¥–∞–Ω—ñ.
- **`user_picture`** ‚Äì –∞–≤–∞—Ç–∞—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º ‚Äì –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è).
- **–ë–µ–∑–ø–µ–∫–∞:** `user_tryes`, `user_ip`, `user_browser` ‚Äì –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–µ–≤–¥–∞–ª–∏—Ö —Å–ø—Ä–æ–± –≤—Ö–æ–¥—É.
- **–ó–≤‚Äô—è–∑–æ–∫:** `chats = basa.relationship("Chats", backref="user", lazy=True)` ‚Äì –æ–¥–∏–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –º–∞—Ç–∏ –±–∞–≥–∞—Ç–æ —á–∞—Ç—ñ–≤.

#### 2Ô∏è‚É£ **`Chats` ‚Äì –ö–ª–∞—Å —á–∞—Ç—ñ–≤**
–¶—è –º–æ–¥–µ–ª—å –∑–±–µ—Ä—ñ–≥–∞—î —Å—Ç–≤–æ—Ä–µ–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º —á–∞—Ç–∏:
- **`id`** ‚Äì —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä —á–∞—Ç—É.
- **`name`** ‚Äì –Ω–∞–∑–≤–∞ —á–∞—Ç—É.
- **`color`** ‚Äì –≤–∏–±—Ä–∞–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º –∫–æ–ª—ñ—Ä.
- **`created_at`** ‚Äì –¥–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è.
- **–ó–≤‚Äô—è–∑–æ–∫:**  
  - `messages = basa.relationship("Messages", backref="chat", lazy=True)` ‚Äì –∑–≤‚Äô—è–∑–æ–∫ —á–∞—Ç—É –∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏.

#### 3Ô∏è‚É£ **`Messages` ‚Äì –ö–ª–∞—Å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å**
–¶—è –º–æ–¥–µ–ª—å –∑–±–µ—Ä—ñ–≥–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —á–∞—Ç—ñ:
- **`id`** ‚Äì —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.
- **`chat_id`** ‚Äì –ø—Ä–∏–≤‚Äô—è–∑–∫–∞ –¥–æ —á–∞—Ç—É (`ForeignKey`).
- **`user_message`** ‚Äì –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
- **`ai_response`** ‚Äì –≤—ñ–¥–ø–æ–≤—ñ–¥—å –®–Ü.
- **`timestamp`** ‚Äì —á–∞—Å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.

---

### **–û–Ω–æ–≤–ª–µ–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç —ñ–∑ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è–º–∏**
```python
from flask_sqlalchemy import SQLAlchemy
from flask_login import UserMixin
from datetime import datetime

basa = SQLAlchemy()  # –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î—Ç–µ –±–∞–∑—É –¥–∞–Ω–∏—Ö —É –¥–æ–¥–∞—Ç–∫—É

class Users(UserMixin, basa.Model):
    __tablename__ = "users"
    id = basa.Column(basa.Integer, primary_key=True)
    user_name = basa.Column(basa.String(50), nullable=False)
    user_mail = basa.Column(basa.String(80), unique=True, nullable=False)
    user_password = basa.Column(basa.String(100), nullable=False)
    user_data = basa.Column(basa.String(50), nullable=False)
    last_seen = basa.Column(basa.String(50), nullable=True)
    user_status = basa.Column(basa.String(80), nullable=False, default="User")
    user_picture = basa.Column(basa.String(100), nullable=True, default="https://external-content.duckduckgo.com/...")

    # –ë–µ–∑–ø–µ–∫–∞:
    user_tryes = basa.Column(basa.Integer, default=3)
    user_ip = basa.Column(basa.String(75))
    user_browser = basa.Column(basa.String(200))

    # –ó–≤'—è–∑–æ–∫ "–æ–¥–∏–Ω –¥–æ –±–∞–≥–∞—Ç—å–æ—Ö" –∑ —á–∞—Ç–∞–º–∏
    chats = basa.relationship("Chats", backref="user", lazy=True)

class Chats(basa.Model):
    __tablename__ = "chats"  # –¢–∞–±–ª–∏—Ü—è –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –≤–∏–∑–Ω–∞—á–µ–Ω–∞ –ø–µ—Ä–µ–¥ –∫–æ–ª–æ–Ω–∫–∞–º–∏
    id = basa.Column(basa.Integer, primary_key=True)
    user_id = basa.Column(basa.Integer, basa.ForeignKey("users.id"), nullable=False)  # –ü—Ä–∏–≤‚Äô—è–∑–∫–∞ –¥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    name = basa.Column(basa.String(100), nullable=False)
    color = basa.Column(basa.String(50), nullable=False)
    created_at = basa.Column(basa.DateTime, default=datetime.utcnow)

    # –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∑–≤‚Äô—è–∑–æ–∫ "–æ–¥–∏–Ω –¥–æ –±–∞–≥–∞—Ç—å–æ—Ö" —ñ–∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏
    messages = basa.relationship("Messages", backref="chat", lazy=True)

class Messages(basa.Model):
    __tablename__ = "messages"
    id = basa.Column(basa.Integer, primary_key=True)
    chat_id = basa.Column(basa.Integer, basa.ForeignKey("chats.id"), nullable=False)  # –ü—Ä–∏–≤'—è–∑–∫–∞ –¥–æ —á–∞—Ç—É
    user_message = basa.Column(basa.Text, nullable=False)
    ai_response = basa.Column(basa.Text, nullable=False)
    timestamp = basa.Column(basa.DateTime, default=datetime.utcnow)
```

---

### **–©–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ?**
1. **–î–æ–¥–∞–Ω–æ `user_id` –¥–æ `Chats`**  
   - –ß–∞—Ç –º–∞—î –Ω–∞–ª–µ–∂–∞—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ (`ForeignKey("users.id")`).

2. **–û–Ω–æ–≤–ª–µ–Ω–æ `backref` —É `Messages`**  
   - –ë—É–ª–æ `backref="Chats"`, –∞ –º–∞–ª–æ –±—É—Ç–∏ `backref="chat"`, —â–æ–± –∑–≤‚Äô—è–∑–æ–∫ –ø—Ä–∞—Ü—é–≤–∞–≤ –∫–æ—Ä–µ–∫—Ç–Ω–æ.

3. **–ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ `__tablename__ = "chats"` —É –ø—Ä–∞–≤–∏–ª—å–Ω–µ –º—ñ—Å—Ü–µ**  
   - –¢–∞–±–ª–∏—Ü—è –º–∞—î –±—É—Ç–∏ –≤–∏–∑–Ω–∞—á–µ–Ω–∞ **–ø–µ—Ä–µ–¥** –∫–æ–ª–æ–Ω–∫–∞–º–∏.

---

### **–Ø–∫ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –¥–∞–Ω—ñ?**
#### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:
```python
new_user = Users(user_name="John", user_mail="john@example.com", user_password="hashed_password")
basa.session.add(new_user)
basa.session.commit()
```

#### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ —á–∞—Ç—É:
```python
user = Users.query.filter_by(user_mail="john@example.com").first()
new_chat = Chats(user_id=user.id, name="My Chat", color="#FF5733")
basa.session.add(new_chat)
basa.session.commit()
```

#### –î–æ–¥–∞–≤–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:
```python
new_message = Messages(chat_id=new_chat.id, user_message="–ü—Ä–∏–≤—ñ—Ç!", ai_response="–ü—Ä–∏–≤—ñ—Ç, —è–∫ —Å–ø—Ä–∞–≤–∏?")
basa.session.add(new_message)
basa.session.commit()
```

#### –û—Ç—Ä–∏–º–∞–Ω–Ω—è –≤—Å—ñ—Ö —á–∞—Ç—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:
```python
user_chats = Users.query.get(user.id).chats
for chat in user_chats:
    print(f"–ß–∞—Ç: {chat.name}, –ö–æ–ª—ñ—Ä: {chat.color}")
```

---

### **–ü—ñ–¥—Å—É–º–æ–∫**
‚úÖ –ö–æ–¥ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ, —ñ –∑–≤‚Äô—è–∑–∫–∏ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º—É—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–æ.  
‚úÖ –¢–µ–ø–µ—Ä –∫–æ–∂–µ–Ω —á–∞—Ç –Ω–∞–ª–µ–∂–∏—Ç—å **–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ** (`user_id`).  
‚úÖ –ö–æ–¥ –ø—ñ–¥—Ç—Ä–∏–º—É—î **–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —á–∞—Ç—É —Ç–∞ –ø—Ä–∏–≤‚Äô—è–∑–∫—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å**.  
‚úÖ –ú–æ–∂–Ω–∞ **–æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –≤—Å—ñ —á–∞—Ç–∏** —Ç–∞ **–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —á–∞—Ç—ñ**.

–¢–∏ –¥–æ–±—Ä–µ –≤—Å–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–≤, –ª–∏—à–∏–ª–æ—Å—å —Ç—ñ–ª—å–∫–∏ –ø—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏. –Ø–∫—â–æ –≤–∏–Ω–∏–∫–Ω—É—Ç—å –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–∏—Ç–∞–Ω–Ω—è ‚Äî –ø–∏—Ç–∞–π, –∑–∞–≤–∂–¥–∏ —Ä–∞–¥–∏–π –¥–æ–ø–æ–º–æ–≥—Ç–∏! üòä
